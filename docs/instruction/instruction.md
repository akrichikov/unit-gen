---
layout: default
title: Instruction Builder
nav_order: 4
has_children: true
permalink: /instruction
---

Unit Eval with combined with CodeContextStrategy and CompletionBuilderType to build the instruction.

The instructions will be generated by the following steps:

| CodeContextStrategy | Description                                                              | 
|---------------------|--------------------------------------------------------------------------|
| SimilarChunks       | tokenize path to find similar path, then calculate similar chunk by path |
| RelatedCode         | use static analysis by imports to calculate related code                 |

for example:

|                      | SimilarChunks    | RelatedCode |
|----------------------|------------------|-------------|
| InlineCompletion     | afterCursor > 10 |             |
| InBlockCompletion    |                  |             |
| AfterBlockCompletion |                  |             |
| TestCode             |                  |             |

If you want to add a new instruction, you need to add a new CodeContextStrategy and CompletionBuilderType.

# Context Strategy

```kotlin
enum class BizCodeContextStrategy {
    /**
     * the AutoDev with pre-build context for un-support language
     */
    SIMILAR_CHUNKS,

    /**
     * the AutoDev with pre-build context
     */
    RELATED_CODE;

    fun builder(context: JobContext): CodeContextBuilder<out Any> {
        return mapOf(
            SIMILAR_CHUNKS to SimilarChunksCompletionBuilder(context),
            RELATED_CODE to RelatedCodeCompletionBuilder(context),
        )[this] ?: throw SerializationException("Unknown message type: $this")
    }
}
```

# Completion Type

```kotlin
enum class CompletionBuilderType {
    /**
     * generate code after cursor, like text after `Blog blog = `, will be `new Blog();`
     */
    INLINE_COMPLETION,

    /**
     * generate the rest of code of correct block, like function inner code
     */
    IN_BLOCK_COMPLETION,

    /**
     * generate code after block, like multiple functions
     */
    AFTER_BLOCK_COMPLETION,

    /**
     * generate full file code, like test code, class code, api code
     */
    TEST_CODE_GEN,
}
```

